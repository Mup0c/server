# Export single table from backup
# (xtrabackup with --prepare --export)
call mtr.add_suppression("InnoDB: Cannot delete tablespace");
CREATE TABLE t2 (`id` INT PRIMARY KEY) ENGINE=INNODB;

INSERT INTO t2 values(1);

CREATE TABLE t1 (id INT, t2_id INT,
INDEX par_ind (t2_id),
FOREIGN KEY `fk_t2_id` (t2_id) REFERENCES t2(`id`)
) ENGINE=INNODB;

INSERT INTO t1 VALUES(2,1);
echo # xtrabackup backup;

let $targetdir=$MYSQLTEST_VARDIR/tmp/backup;
--disable_result_log
# Test renames before of after copying tablespaces
exec $XTRABACKUP --defaults-file=$MYSQLTEST_VARDIR/my.cnf  --backup "--tables=test.t*" --target-dir=$targetdir;
--enable_result_log
list_files $targetdir/test *.ibd;

DROP TABLE t1;
DROP TABLE t2;

echo # xtrabackup prepare;
--disable_result_log
exec $XTRABACKUP --defaults-file=$MYSQLTEST_VARDIR/my.cnf --defaults-group-suffix=.1 --prepare --export --target-dir=$targetdir;
--enable_result_log
--disable_result_log
exec $XTRABACKUP --defaults-file=$MYSQLTEST_VARDIR/my.cnf --defaults-group-suffix=.1 --copy-back --import --target-dir=$targetdir;
--enable_result_log

SELECT * FROM t2;
SELECT * FROM t1;
DROP TABLE t1;
DROP TABLE t2;
rmdir $targetdir;
